!function(r,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((r="undefined"!=typeof globalThis?globalThis:r||self).Awh={})}(this,(function(r){"use strict";async function t(r,t,e,o,a,i){if(!r)throw Error("context is required");if(!t)throw Error("formUuid is required");if(!e)throw Error("form instance id is required");if(!o)throw Error("table field id is required");a=a||1,i=i||10;const n=await r.dataSourceMap.fetchSubformDatas.load({formUuid:t,formInstanceId:e,tableFieldId:o,currentPage:a,pageSize:i}),{totalCount:s,data:c}=n;return{totalCount:s,subformDatas:c||[],currentPage:a}}async function e(r,t,e,o,a,i,n){if(!r)throw Error("context is required");if(!e)throw Error("formUuid is required");t||(t="form");const s=JSON.stringify(o||{});let c;if(n&&n.dynamicOrder&&(n.dynamicOrder=JSON.stringify(n.dynamicOrder||{})),"form"===t)c=r.dataSourceMap.searchFormDataIds.load({formUuid:e,searchFieldJson:s,currentPage:a,pageSize:i,...n});else{if("process"!==t)throw Error("Unknow form type: ",t);c=r.dataSourceMap.getInstanceIds.load({formUuid:e,searchFieldJson:s,currentPage:a,pageSize:i,...n})}const d=await c,{currentPage:f,totalCount:u,data:l}=d;return{currentPage:f,totalCount:u,ids:l}}async function o(r,t,e,o,a,i,n){if(!r)throw Error("context is required");if(!e)throw Error("formUuid is required");t||(t="form");const s=JSON.stringify(o||{});let c;if(n&&n.dynamicOrder&&(n.dynamicOrder=JSON.stringify(n.dynamicOrder||{})),"form"===t)c=r.dataSourceMap.searchFormDatas.load({formUuid:e,searchFieldJson:s,currentPage:a,pageSize:i,...n});else{if("process"!==t)throw Error("Unknow form type: ",t);c=r.dataSourceMap.getInstances.load({formUuid:e,searchFieldJson:s,currentPage:a,pageSize:i,...n})}const d=await c,{currentPage:f,totalCount:u,data:l}=d;return{currentPage:f,totalCount:u,formDatas:(l||[]).map((r=>({...r,...r.formData,...r.data})))}}function a(r){return new Promise((t=>{setTimeout(t,r)}))}r.deleteFormData=async function(r,t){if(!r)throw Error("context is required");if(!t)throw Error("instanceId is required");return await r.dataSourceMap.deleteFormData.load({formInstId:t})},r.dialog=function(r,t,e,o){return new Promise(((a,i)=>{r.utils.dialog({type:t,title:e,content:o,footerActions:["cancel","ok"],onOk:()=>{a()},onCancel:()=>{i()}})}))},r.fetchSubformDatas=t,r.fetchSubformDatasAll=async function(r,e,o,a){if(!r)throw Error("context is required");if(!e)throw Error("formUuid is required");if(!o)throw Error("form instance id is required");if(!a)throw Error("table field id is required");let i=[],n=1;for(;;){const{subformDatas:s}=await t(r,e,o,a,n,50);if(i=i.concat(s),50!==s.length)break;n+=1}return i},r.getFormData=function(r,t,e){if(!r)throw Error("context is required");if(t||(t="form"),!e)throw Error("formInstId is required");let o;if("form"===t?o=r.dataSourceMap.getFormData.load({formInstId:e}).then((r=>r.formData)):"process"===t&&(o=r.dataSourceMap.getProcessInstance.load({processInstanceId:e}).then((r=>r.data))),!o)throw Error(`Unknown typeï¼š${t}`);return o},r.hijackSubmit=function(r){const t=document.querySelector(".deep-form-submit");if(!t)return;const e=t.parentElement;e.style.position="relative";const o=t.getBoundingClientRect(),a=document.createElement("div");a.style.position="absolute",a.style.top=t.offsetTop+"px",a.style.left=t.offsetLeft+"px",a.style.display="inline-block",a.style.width=o.width+"px",a.style.height=o.height+"px",a.onclick=()=>{try{r.beforeBeforeSubmit,t.click()}catch(r){console.log(r.message)}},e.appendChild(a)},r.loading=function(r,t,e,o=!1){return r.utils.toast({type:"loading",title:t,size:e,hasMask:o})},r.retry=async function(r,t=3,e=300,...o){let i,n,s=0;for(;s<=t;){s>0&&await a(e);try{return i=r(...o),i instanceof Promise&&await i,i}catch(r){s+=1,n=r}}let c=`All ${t} retries failed.`;throw n&&(c+=`Error: ${n.message}`),Error(c)},r.saveFormData=async function(r,t,e){if(!r)throw Error("context is required");if(!t)throw Error("formUuid is required");e||(e={});const o=JSON.stringify(e);return await r.dataSourceMap.saveFormData.load({formUuid:t,formDataJson:o})},r.searchFormDataIds=e,r.searchFormDataIdsAll=async function(r,t,o,a,i){t||(t="form");let n=[],s=1;for(;;){const{ids:c}=await e(r,t,o,a,s,100,i);if(n=n.concat(c),100!==c.length)break;s+=1}return n},r.searchFormDatas=o,r.searchFormDatasAll=async function(r,t,e,a,i){t||(t="form");let n=[],s=1;for(;;){const{formDatas:c}=await o(r,t,e,a,s,100,i);if(n=n.concat(c),100!==c.length)break;s+=1}return n},r.sleep=a,r.updateFormData=async function(r,t,e,o,a=!1){if(!r)throw Error("context is required");if(!e)throw Error("instanceId is required");t||(t="form"),o||(o={});const i=JSON.stringify(o);let n;n="form"===t?r.dataSourceMap.updateFormData.load({formInstId:e,updateFormDataJson:i,useLatestVersion:a}):r.dataSourceMap.updateInstance.load({processInstanceId:e,updateFormDataJson:i}),await n}}));
