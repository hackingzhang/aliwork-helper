<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>data-source.js - Aliwork helper</title>
    
    <meta name="description" content="ÂÆúÊê≠ÂâçÁ´Ø JS Â∑•ÂÖ∑‰ª£Á†ÅÂ∫ì" />
    
        <meta name="keywords" content="Aliwork ÂÆúÊê≠ Â∑•ÂÖ∑Â∫ì" />
        <meta name="keyword" content="Aliwork ÂÆúÊê≠ Â∑•ÂÖ∑Â∫ì" />
    
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/hackingzhang/aliwork-helper" target="_blank" class="menu-item" >Github</a></h2><h2><a href="https://gitee.com/hexzhangshuai/aliwork-helper" target="_blank" class="menu-item" >GiteeÁ†Å‰∫ë</a></h2><h2><a href="https://docs.aliwork.com/docs/developer/api/about" target="_blank" class="menu-item" >ÂÆúÊê≠ÂºÄÊîæAPI</a></h2><h3>Modules</h3><ul><li><a href="module-DataLinkage.html">DataLinkage</a><ul class='methods'><li data-type='method'><a href="module-DataLinkage.html#.dataLinkage">dataLinkage</a></li><li data-type='method'><a href="module-DataLinkage.html#.dataLinkageSubform">dataLinkageSubform</a></li><li data-type='method'><a href="module-DataLinkage.html#~resolveConditionMap">resolveConditionMap</a></li></ul></li><li><a href="module-DataSource.html">DataSource</a><ul class='methods'><li data-type='method'><a href="module-DataSource.html#.deleteFormData">deleteFormData</a></li><li data-type='method'><a href="module-DataSource.html#.fetchSubformDatas">fetchSubformDatas</a></li><li data-type='method'><a href="module-DataSource.html#.fetchSubformDatasAll">fetchSubformDatasAll</a></li><li data-type='method'><a href="module-DataSource.html#.getFormData">getFormData</a></li><li data-type='method'><a href="module-DataSource.html#.saveFormData">saveFormData</a></li><li data-type='method'><a href="module-DataSource.html#.searchFormDataIds">searchFormDataIds</a></li><li data-type='method'><a href="module-DataSource.html#.searchFormDataIdsAll">searchFormDataIdsAll</a></li><li data-type='method'><a href="module-DataSource.html#.searchFormDatas">searchFormDatas</a></li><li data-type='method'><a href="module-DataSource.html#.searchFormDatasAll">searchFormDatasAll</a></li><li data-type='method'><a href="module-DataSource.html#.startInstance">startInstance</a></li><li data-type='method'><a href="module-DataSource.html#.updateFormData">updateFormData</a></li></ul></li><li><a href="module-Field.html">Field</a><ul class='methods'><li data-type='method'><a href="module-Field.html#.activateTabItems">activateTabItems</a></li><li data-type='method'><a href="module-Field.html#.fieldToString">fieldToString</a></li><li data-type='method'><a href="module-Field.html#.fieldValueDiff">fieldValueDiff</a></li><li data-type='method'><a href="module-Field.html#.fieldValueEqualSingle">fieldValueEqualSingle</a></li><li data-type='method'><a href="module-Field.html#.generateAssociationFormFieldData">generateAssociationFormFieldData</a></li><li data-type='method'><a href="module-Field.html#.generateDptFieldData">generateDptFieldData</a></li><li data-type='method'><a href="module-Field.html#.generateEmployeeFieldData">generateEmployeeFieldData</a></li><li data-type='method'><a href="module-Field.html#.getFieldDataTypeById">getFieldDataTypeById</a></li><li data-type='method'><a href="module-Field.html#.getFieldTypeById">getFieldTypeById</a></li><li data-type='method'><a href="module-Field.html#.mergeTo">mergeTo</a></li><li data-type='method'><a href="module-Field.html#.syncTo">syncTo</a></li></ul></li><li><a href="module-Subform.html">Subform</a><ul class='methods'><li data-type='method'><a href="module-Subform.html#.associateForm2Subform">associateForm2Subform</a></li><li data-type='method'><a href="module-Subform.html#.sum2Main">sum2Main</a></li><li data-type='method'><a href="module-Subform.html#~resolveFieldMaps">resolveFieldMaps</a></li></ul></li><li><a href="module-UI.html">UI</a><ul class='methods'><li data-type='method'><a href="module-UI.html#.dialog">dialog</a></li><li data-type='method'><a href="module-UI.html#.hijackSubmit">hijackSubmit</a></li><li data-type='method'><a href="module-UI.html#.loading">loading</a></li></ul></li><li><a href="module-Utils.html">Utils</a><ul class='methods'><li data-type='method'><a href="module-Utils.html#.dateTimeFormat">dateTimeFormat</a></li><li data-type='method'><a href="module-Utils.html#.generateRandomId">generateRandomId</a></li><li data-type='method'><a href="module-Utils.html#.isEmpty">isEmpty</a></li><li data-type='method'><a href="module-Utils.html#.retry">retry</a></li><li data-type='method'><a href="module-Utils.html#.round">round</a></li><li data-type='method'><a href="module-Utils.html#.sleep">sleep</a></li></ul></li></ul><h3>Classes</h3><ul><li><a href="FieldChangeLogger.html">FieldChangeLogger</a><ul class='methods'><li data-type='method'><a href="FieldChangeLogger.html#change">change</a></li><li data-type='method'><a href="FieldChangeLogger.html#clear">clear</a></li><li data-type='method'><a href="FieldChangeLogger.html#format">format</a></li></ul></li><li><a href="module-Subform-Subform.html">Subform</a><ul class='methods'><li data-type='method'><a href="module-Subform-Subform.html#getDatas">getDatas</a></li><li data-type='method'><a href="module-Subform-Subform.html#getFormGroupId">getFormGroupId</a></li><li data-type='method'><a href="module-Subform-Subform.html#getFormGroupIds">getFormGroupIds</a></li><li data-type='method'><a href="module-Subform-Subform.html#getIndex">getIndex</a></li><li data-type='method'><a href="module-Subform-Subform.html#getInstance">getInstance</a></li><li data-type='method'><a href="module-Subform-Subform.html#getItem">getItem</a></li><li data-type='method'><a href="module-Subform-Subform.html#setDatas">setDatas</a></li><li data-type='method'><a href="module-Subform-Subform.html#summary">summary</a></li><li data-type='method'><a href="module-Subform-Subform.html#updateItem">updateItem</a></li></ul></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">data-source.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * Ë∑®Â∫îÁî®Êï∞ÊçÆÊ∫êÁõ∏ÂÖ≥ÊñπÊ≥ïÂ∞ÅË£Ö, ËØ¶ÊÉÖÂèÇËÄÉÂÆúÊê≠ÊñáÊ°£ {@link https://docs.aliwork.com/docs/developer/api/openAPI}
 * @module DataSource
 */

import { getFieldTypeById } from "./field";

/**
 * Âà†Èô§Ë°®ÂçïÂÆû‰æãÊï∞ÊçÆ
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {string} instanceId ÂÆû‰æãID
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // ÂêçÁß∞ÔºödeleteFormData
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöPOST
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/deleteFormData.json
 *
 * deleteFormData(this, "FINST-12839128319823").then(() => {
 *   console.log("Âà†Èô§ÊàêÂäü");
 * }, (e) => {
 *   console.log(`Âà†Èô§Â§±Ë¥•Ôºö${e.message}`);
 * });
 */
async function deleteFormData(context, instanceId) {
  if (!context) throw Error("context is required");
  if (!instanceId) throw Error("instanceId is required");

  const resp = await context.dataSourceMap.deleteFormData.load({
    formInstId: instanceId,
  });

  return resp;
}

/**
 * Ëé∑ÂèñÂ≠êË°®Êï∞ÊçÆÂìçÂ∫îÂØπË±°
 * @typedef {Object} module:DataSource.SubformDatasResponse
 * @property {number} totalCount Â≠êË°®Êï∞ÊçÆÊÄªÊù°Êï∞
 * @property {number} currentPage ÂΩìÂâçÈ°µÁ†Å
 * @property {Array&lt;Object>} subformDatas Â≠êË°®Êï∞ÊçÆÊï∞ÁªÑ
 */

/**
 * ÂàÜÈ°µËé∑ÂèñÂ≠êË°®Êï∞ÊçÆ
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {string} formUuid Ë°®ÂçïID
 * @param {string} formInstanceId Ë°®ÂçïÂÆû‰æãID
 * @param {string} tableFieldId Â≠êË°®ÂîØ‰∏ÄÊ†áËØÜ
 * @param {number} currentPage ÂΩìÂâçÈ°µÔºå ÈªòËÆ§‰∏∫1
 * @param {number} pageSize ÊØèÈ°µËÆ∞ÂΩïÊï∞ÔºåÊúÄÂ§ß50Êù°ÔºåÈªòËÆ§‰∏∫10
 * @returns {Promise&lt;module:DataSource.SubformDatasResponse>}
 * ‰∏Ä‰∏™PromiseÔºåresolveÂìçÂ∫îÂØπË±°ÔºåÂèÇËßÅÔºö{@link module:DataSource.SubformDatasResponse}
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // ÂêçÁß∞ÔºöfetchSubformDatas
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/listTableDataByFormInstIdAndTableId.json
 *
 * fetchSubformDatas(
 *   this,
 *   "FORM-xxxxxx",
 *   "FINST-xxxxxx",
 *   "tableField_xxxxxx",
 *    1, 50
 *  ).then(resp => {
 *    const { totalCount, subformDatas, currentPage } = resp;
 *  }, (e) => {
 *    console.log(`Ëé∑ÂèñÂ§±Ë¥•Ôºö${e.message}`);
 *  });
 */
async function fetchSubformDatas(
  context,
  formUuid,
  formInstanceId,
  tableFieldId,
  currentPage,
  pageSize
) {
  if (!context) {
    throw Error("context is required");
  }
  if (!formUuid) {
    throw Error("formUuid is required");
  }
  if (!formInstanceId) {
    throw Error("form instance id is required");
  }
  if (!tableFieldId) {
    throw Error("table field id is required");
  }

  currentPage = currentPage || 1;
  pageSize = pageSize || 10;

  const response = await context.dataSourceMap.fetchSubformDatas.load({
    formUuid,
    formInstanceId,
    tableFieldId,
    currentPage,
    pageSize,
  });

  const { totalCount, data } = response;
  const subformDatas = data || [];

  return {
    totalCount,
    subformDatas,
    currentPage,
  };
}

/**
 * Ëé∑ÂèñÊâÄÊúâÂ≠êË°®Êï∞ÊçÆ
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {string} formUuid Ë°®ÂçïID
 * @param {string} formInstanceId Ë°®ÂçïÂÆû‰æãID
 * @param {string} tableFieldId Â≠êË°®ÂîØ‰∏ÄÊ†áËØÜ
 * @returns {Promise&lt;Array&lt;Object>>} ‰∏Ä‰∏™PromiseÔºåresolveÊâÄÊúâÂ≠êË°®Êï∞ÊçÆÊï∞ÁªÑ
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // ÂêçÁß∞ÔºöfetchSubformDatas
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/listTableDataByFormInstIdAndTableId.json
 *
 * fetchSubformDatasAll(
 *   this,
 *   "FORM-xxxxxx",
 *   "FINST-xxxxxx",
 *   "tableField_xxxxxx",
 *  ).then(allsubformDatas => {
 *    console.log("Â≠êË°®Êï∞ÊçÆÔºö", allsubformDatas);
 *  }, (e) => {
 *    console.log(`Ëé∑ÂèñÂ§±Ë¥•Ôºö${e.message}`);
 *  });
 */
async function fetchSubformDatasAll(
  context,
  formUuid,
  formInstanceId,
  tableFieldId
) {
  if (!context) {
    throw Error("context is required");
  }
  if (!formUuid) {
    throw Error("formUuid is required");
  }
  if (!formInstanceId) {
    throw Error("form instance id is required");
  }
  if (!tableFieldId) {
    throw Error("table field id is required");
  }

  let allsubformDatas = [];
  let currentPage = 1;
  const pageSize = 50;

  const t = true;
  while (t) {
    const { subformDatas } = await fetchSubformDatas(
      context,
      formUuid,
      formInstanceId,
      tableFieldId,
      currentPage,
      pageSize
    );
    allsubformDatas = allsubformDatas.concat(subformDatas);

    if (subformDatas.length !== pageSize) {
      break;
    }

    currentPage += 1;
  }

  return allsubformDatas;
}

/**
 * Ëé∑ÂèñË°®ÂçïÂÆû‰æãËØ¶ÊÉÖ
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {"form" | "process"} type Á±ªÂûãÔºåÂèñÂÄº‰∏∫ form-Ë°®Âçï ÊàñËÄÖ porcess-ÊµÅÁ®ã
 * @param {string} formInstId Ë°®ÂçïÂÆû‰æãID
 * @return {Promise&lt;Object>} ‰∏Ä‰∏™PromiseÔºåresolveË°®ÂçïÂÆû‰æãÊï∞ÊçÆ
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // Â¶ÇÊûúË¶ÅËé∑ÂèñÊôÆÈÄöË°®ÂçïÂÆû‰æãËØ¶ÊÉÖ
 * // ÂêçÁß∞ÔºögetFormData
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/getFormDataById.json
 * // Â¶ÇÊûúË¶ÅËé∑ÂèñÊµÅÁ®ãË°®ÂçïÂÆû‰æãËØ¶ÊÉÖ
 * // ÂêçÁß∞ÔºögetProcessInstance
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/getInstanceById.json
 *
 * // Ëé∑ÂèñÊôÆÈÄöË°®ÂçïÂÆû‰æãÊï∞ÊçÆ
 * getFormData(this, "form", "FINST-TD866Y81CHLF6FVA9WR6J7GQPBM72KUTJRFOL6T9")
 * .then(formData => {
 *   console.log("Ë°®ÂçïÂÆû‰æãÊï∞ÊçÆ", formData);
 * }).catch(e => {
 *   console.log(`Ëé∑ÂèñÂ§±Ë¥•Ôºö${e.message}`);
 * });
 *
 * // Ëé∑ÂèñÊµÅÁ®ãË°®ÂçïÂÆû‰æãÊï∞ÊçÆ
 * getFormData(this, "process", "62a1ef56-8ded-4e77-89a0-db32c95a6d04")
 * .then(formData => {
 *   console.log("ÊµÅÁ®ãÂÆû‰æãÊï∞ÊçÆ", formData);
 * }).catch(e => {
 *   console.log(`Ëé∑ÂèñÂ§±Ë¥•Ôºö${e.message}`);
 * });
 */
function getFormData(context, type, instId) {
  if (!context) {
    throw Error("context is required");
  }
  if (!type) {
    type = "form";
  }
  if (!instId) {
    throw Error("formInstId is required");
  }

  let req;
  if (type === "form") {
    req = context.dataSourceMap.getFormData
      .load({ formInstId: instId })
      .then((response) => {
        return response.formData;
      });
  } else if (type === "process") {
    req = context.dataSourceMap.getProcessInstance
      .load({
        processInstanceId: instId,
      })
      .then((response) => {
        return response.data;
      });
  }

  if (!req) throw Error(`Unknown typeÔºö${type}`);
  return req;
}

/**
 * Êñ∞Âª∫Ë°®ÂçïÂÆû‰æã
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {string} formUuid Ë°®ÂçïID
 * @param {Object} formData Ë°®ÂçïÊï∞ÊçÆÂØπË±°
 * @returns {Promise&lt;string>} ‰∏Ä‰∏™PromiseÔºåresolveË°®ÂçïÂÆû‰æãID
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // ÂêçÁß∞ÔºösaveFormData
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöPOST
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/saveFormData.json
 *
 * saveFormData(
 *   this,
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello", numberField_xxxxxx: 100 },
 * ).then(
 *   (instanceId) => {
 *     console.log("ÂàõÂª∫ÊàêÂäüÔºåÂÆû‰æãIDÔºö${instanceId}");
 *   },
 *   (e) => {
 *     console.log(`ÂàõÂª∫Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * )
 */
async function saveFormData(context, formUuid, formData) {
  if (!context) {
    throw Error("context is required");
  }
  if (!formUuid) {
    throw Error("formUuid is required");
  }
  if (!formData) {
    formData = {};
  }

  const formDataJson = JSON.stringify(formData);

  const instanceId = await context.dataSourceMap.saveFormData.load({
    formUuid,
    formDataJson,
  });

  return instanceId;
}

/**
 * ÂèëËµ∑ÊµÅÁ®ã
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {string} processCode ÊµÅÁ®ã code
 * @param {string} formUuid Ë°®ÂçïID
 * @param {Object} formData Ë°®ÂçïÊï∞ÊçÆÂØπË±°
 * @param {string} [dptId] ÂèëËµ∑ÈÉ®Èó®IDÔºåÂ¶Ç‰∏çÂ°´ÈªòËÆ§‰∏∫ÂèëËµ∑‰∫∫‰∏ª‰∫ãÈÉ®Èó®
 * @returns {Promise&lt;string>} ‰∏Ä‰∏™PromiseÔºåresolveÊµÅÁ®ãÂÆû‰æãID
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // ÂêçÁß∞ÔºöstartInstance
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöPOST
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/startInstance.json
 *
 * startInstance(
 *   this,
 *   "TPROC--xxxxxx",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello", numberField_xxxxxx: 100 },
 * ).then(
 *   (instanceId) => {
 *     console.log("ÂàõÂª∫ÊàêÂäüÔºåÂÆû‰æãIDÔºö${instanceId}");
 *   },
 *   (e) => {
 *     console.log(`ÂàõÂª∫Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * )
 */
async function startInstance(context, processCode, formUuid, formData, dptId) {
  if (!context) {
    throw Error("context is required");
  }
  if (!processCode) {
    throw Error("processCode is required");
  }
  if (!formUuid) {
    throw Error("formUuid is required");
  }
  if (!formData) {
    formData = {};
  }

  const formDataJson = JSON.stringify(formData);

  const instanceId = await context.dataSourceMap.startInstance.load({
    processCode,
    formUuid,
    formDataJson,
    dptId,
  });

  return instanceId;
}

/**
 * ÊµÅÁ®ãÂÆû‰æãÁä∂ÊÄÅ&lt;br/>
 * RUNNING - ËøêË°å‰∏≠&lt;br/>
 * TERMINATED - Â∑≤ÁªàÊ≠¢&lt;br/>
 * COMPLETED - Â∑≤ÂÆåÊàê&lt;br/>
 * ERROR - ÂºÇÂ∏∏
 * @typedef {"RUNNING" | "TERMINATED" | "COMPLETED" | "ERROR"} ProcessStatus
 */

/**
 * ÊµÅÁ®ãÂÆ°ÊâπÁªìÊûú&lt;br/>
 * agree - ÂêåÊÑè&lt;br/>
 * disagree - ‰∏çÂêåÊÑè
 * @typedef {"agree" | "disagree"} ApprovedResult
 */

/**
 * ÊêúÁ¥¢Ë°®ÂçïÔºàÊµÅÁ®ãÔºâÂÆû‰æãÊï∞ÊçÆÔºàIDÔºâÈÄâÈ°π
 * @typedef {Object} SearchFormDatasOption
 * @property {boolean} strictQuery ‰∏•Ê†ºÔºàÁ≤æÁ°ÆÔºâÊü•ËØ¢ÔºåÈªòËÆ§‰∏çÂêØÁî®„ÄÇÂΩì‰ΩøÁî®ÂçïË°åÊñáÊú¨ÊàñËÄÖÂ§öË°åÊñáÊú¨ÁªÑ‰ª∂‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂Êó∂ÊâßË°åÁöÑÊòØÊ®°Á≥äÊü•ËØ¢Ôºå
 * ÊØîÂ¶ÇÊü•ËØ¢"Âº†‰∏â"‰ºöÊää‚ÄúÂº†‰∏â‰∏∞‚Äù‰πüÊü•ËØ¢Âá∫Êù•„ÄÇÂ∞ÜstrictQueryËÆæÁΩÆ‰∏∫ture‰ºöÂØπÊü•ËØ¢ÁªìÊûúÊâßË°åËøõ‰∏ÄÊ≠•Á≠õÈÄâÔºå‰øùËØÅËøîÂõûÊñáÊú¨‰∏•Ê†ºÁõ∏Á≠âÁöÑÊï∞ÊçÆ„ÄÇ&lt;br/>
 * ‚ö†Ô∏èÊü•ËØ¢Ë°®ÂçïÂÆû‰æãIDÊñπÊ≥ï{@link module:DataSource.searchFormDataIds} {@link module:DataSource.searchFormDataIdsAll}‰∏çÊîØÊåÅÊ≠§ÈÄâÈ°π„ÄÇ&lt;br/>
 * ‚ö†Ô∏èÂ¶ÇÊûú‰ΩøÁî®ÂàÜÈ°µÊü•ËØ¢Ôºå‰∏•Ê†ºÊü•ËØ¢ÁöÑÁªìÊûúÊï∞ÈáèÂèØËÉΩÂ∞ë‰∫éÂàÜÈ°µÊï∞Èáè„ÄÇ
 * @property {Object} dynamicOrder ÊéíÂ∫èËßÑÂàô
 * @property {string} originatorId Êï∞ÊçÆÊèê‰∫§‰∫∫/ÊµÅÁ®ãÂèëËµ∑‰∫∫Â∑•Âè∑
 * @property {string} createFrom Êü•ËØ¢Âú®ËØ•Êó∂Èó¥ÊÆµÂàõÂª∫ÁöÑÊï∞ÊçÆÂàóË°®
 * @property {string} createTo Êü•ËØ¢Âú®ËØ•Êó∂Èó¥ÊÆµÂàõÂª∫ÁöÑÊï∞ÊçÆÂàóË°®
 * @property {string} modifiedFrom Êü•ËØ¢Âú®ËØ•Êó∂Èó¥ÊÆµÊúâ‰øÆÊîπÁöÑÊï∞ÊçÆÂàóË°®
 * @property {string} modifiedTo Êü•ËØ¢Âú®ËØ•Êó∂Èó¥ÊÆµÊúâ‰øÆÊîπÁöÑÊï∞ÊçÆÂàóË°®
 * @property {string} taskId ‰ªªÂä°IDÔºå‰ªÖÊü•ËØ¢ÊµÅÁ®ãË°®ÂçïÊúâÊïà
 * @property {module:DataSource~ProcessStatus} instanceStatus
 * ÂÆû‰æãÁä∂ÊÄÅÔºå‰ªÖÊü•ËØ¢ÊµÅÁ®ãË°®ÂçïÊúâÊïà,ÂèØÈÄâÂÄº‰∏∫ÔºöRUNNING, TERMINATED, COMPLETED, ERROR„ÄÇÂàÜÂà´‰ª£Ë°®ÔºöËøêË°å‰∏≠ÔºåÂ∑≤ÁªàÊ≠¢ÔºåÂ∑≤ÂÆåÊàêÔºåÂºÇÂ∏∏„ÄÇ
 * @property {module:DataSource~ApprovedResult} approvedResult ÊµÅÁ®ãÂÆ°ÊâπÁªìÊûúÔºå‰ªÖÊü•ËØ¢ÊµÅÁ®ãË°®ÂçïÊúâÊïàÔºåÂèØÈÄâÂÄº‰∏∫agree„ÄÅdisagreeÔºåÂàÜÂà´‰ª£Ë°®ÂêåÊÑè„ÄÅ‰∏çÂêåÊÑè„ÄÇ
 */

/**
 * Êü•ËØ¢Ë°®ÂçïÂÆû‰æãIDÂìçÂ∫îÂØπË±°
 * @typedef {Object} module:DataSource.FormDataIdsResponse
 * @property {number} totalCount Ë°®ÂçïÊï∞ÊçÆÊÄªÊù°Êï∞
 * @property {number} currentPage ÂΩìÂâçÈ°µÁ†Å
 * @property {Array&lt;string>} ids Ë°®ÂçïÂÆû‰æãIDÊï∞ÁªÑ
 */

/**
 * Êü•ËØ¢Ë°®ÂçïÂÆû‰æãIDÂàóË°® &lt;br/>
 * ‚ö†Ô∏èÂ¶ÇÊûú‰ΩøÁî®ÊñáÊú¨Â≠óÊÆµÔºàÂçïË°å/Â§öË°åÊñáÊú¨Ôºâ‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂ÔºåÊâßË°åÁöÑÊòØÊ®°Á≥äÊü•ËØ¢ÔºåÊØîÂ¶ÇÊü•ËØ¢‚ÄúÂº†‰∏â‚ÄùÔºå‰ºöÊää‚ÄúÂº†‰∏â‰∏∞"‰πüÊü•ËØ¢Âá∫Êù•
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {"form" | "process"} type Ë°®ÂçïÁ±ªÂûãÔºåÂèØÈÄâ form„ÄÅprocessÔºåÂàÜÂà´‰ª£Ë°®ÊôÆÈÄöË°®ÂçïÂíåÊµÅÁ®ã
 * @param {string} formUuid Ë°®ÂçïID
 * @param {Object} searchFieldObject Ë°®ÂçïÁªÑ‰ª∂Êü•ËØ¢Êù°‰ª∂ÂØπË±°
 * @param {number} currentPage ÂΩìÂâçÈ°µÔºå ÈªòËÆ§‰∏∫1
 * @param {number} pageSize ÊØèÈ°µËÆ∞ÂΩïÊï∞Ôºå ÈªòËÆ§‰∏∫10
 * @param {module:DataSource~SearchFormDatasOption} options Êü•ËØ¢ÈÄâÈ°π
 * @returns {Promise&lt;module:DataSource.FormDataIdsResponse>}
 * ‰∏Ä‰∏™PromiseÔºåresolveË°®ÂçïÂÆû‰æãIDÂìçÂ∫îÂØπË±° {@link module:DataSource.FormDataIdsResponse}
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊôÆÈÄöË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºösearchFormDataIds
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/searchFormDataIds.json
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊµÅÁ®ãË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºögetInstanceIds
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/getInstanceIds.json
 *
 * // ÊêúÁ¥¢ÊôÆÈÄöË°®Âçï
 * searchFormDataIds(
 *   this,
 *   "form",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   1, 100,
 *   { dynamicOrder: "numberField_xxx": "+" }
 * ).then((resp) => {
 *     const { currentPage, totalCount, ids } = resp;
 *     console.log(`ÂÖ±${totalCount}Êù°Êï∞ÊçÆ`);
 *     console.log(ids);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 *
 * // ÊêúÁ¥¢ÊµÅÁ®ãË°®Âçï
 * searchFormDataIds(
 *   this,
 *   "process",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   1, 100,
 *   { dynamicOrder: "numberField_xxx": "+", instanceStatus: "COMPLETED" }
 * ).then((resp) => {
 *     const { currentPage, totalCount, ids } = resp;
 *     console.log(`ÂÖ±${e.totalCount}Êù°Êï∞ÊçÆ`);
 *     console.log(ids);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 */
async function searchFormDataIds(
  context,
  type,
  formUuid,
  searchFieldObject,
  currentPage,
  pageSize,
  options
) {
  if (!context) {
    throw Error("context is required");
  }
  if (!formUuid) {
    throw Error("formUuid is required");
  }
  if (!type) {
    type = "form";
  }

  const searchFieldJson = JSON.stringify(searchFieldObject || {});
  if (options &amp;&amp; options.dynamicOrder) {
    options.dynamicOrder = JSON.stringify(options.dynamicOrder || {});
  }

  let req;
  if (type === "form") {
    req = context.dataSourceMap.searchFormDataIds.load({
      formUuid,
      searchFieldJson,
      currentPage,
      pageSize,
      ...options,
    });
  } else if (type === "process") {
    req = context.dataSourceMap.getInstanceIds.load({
      formUuid,
      searchFieldJson,
      currentPage,
      pageSize,
      ...options,
    });
  } else {
    throw Error("Unknow form type: ", type);
  }

  const response = await req;
  const { currentPage: cPage, totalCount, data: ids } = response;

  return {
    currentPage: cPage,
    totalCount,
    ids,
  };
}

/**
 * Êü•ËØ¢Á¨¶ÂêàÊù°‰ª∂ÁöÑÊâÄÊúâË°®ÂçïÂÆû‰æãID &lt;br/>
 * ‚ö†Ô∏èÂ¶ÇÊûú‰ΩøÁî®ÊñáÊú¨Â≠óÊÆµÔºàÂçïË°å/Â§öË°åÊñáÊú¨Ôºâ‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂ÔºåÊâßË°åÁöÑÊòØÊ®°Á≥äÊü•ËØ¢ÔºåÊØîÂ¶ÇÊü•ËØ¢‚ÄúÂº†‰∏â‚ÄùÔºå‰ºöÊää‚ÄúÂº†‰∏â‰∏∞"‰πüÊü•ËØ¢Âá∫Êù•
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {"form" | "process"} type Ë°®ÂçïÁ±ªÂûãÔºåÂèØÈÄâ form„ÄÅprocessÔºåÂàÜÂà´‰ª£Ë°®ÊôÆÈÄöË°®ÂçïÂíåÊµÅÁ®ã
 * @param {string} formUuid Ë°®ÂçïID
 * @param {Object} searchFieldObject Ë°®ÂçïÁªÑ‰ª∂Êü•ËØ¢Êù°‰ª∂ÂØπË±°
 * @param {module:DataSource~SearchFormDatasOption} options Êü•ËØ¢ÈÄâÈ°π
 * @returns {Promise&lt;Array&lt;string>>} ‰∏Ä‰∏™PromiseÔºåresolveË°®ÂçïÂÆû‰æãIDÊï∞ÁªÑ
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊôÆÈÄöË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºösearchFormDataIds
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/searchFormDataIds.json
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊµÅÁ®ãË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºögetInstanceIds
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/getInstanceIds.json
 *
 * // ÊêúÁ¥¢ÊôÆÈÄöË°®Âçï
 * searchFormDataIdsAll(
 *   this,
 *   "form",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   { dynamicOrder: "numberField_xxx": "+" }
 * ).then((ids) => {
 *     console.log("Êü•ËØ¢ÊàêÂäü", ids);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 *
 * // ÊêúÁ¥¢ÊµÅÁ®ãË°®Âçï
 * searchFormDataIdsAll(
 *   this,
 *   "process",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   { dynamicOrder: "numberField_xxx": "+", instanceStatus: "COMPLETED" }
 * ).then((ids) => {
 *     console.log("Êü•ËØ¢ÊàêÂäü", ids);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 */
async function searchFormDataIdsAll(
  context,
  type,
  formUuid,
  searchFieldObject,
  options
) {
  if (!type) type = "form";

  let allIds = [];
  let currentPage = 1;
  const pageSize = 100;

  const t = true;
  while (t) {
    const { ids } = await searchFormDataIds(
      context,
      type,
      formUuid,
      searchFieldObject,
      currentPage,
      pageSize,
      options
    );
    allIds = allIds.concat(ids);

    if (ids.length !== pageSize) {
      break;
    }

    currentPage += 1;
  }

  return allIds;
}

/**
 * Ë°®ÂçïÂÆû‰æãÊï∞ÊçÆÂØπË±°
 * @typedef {Object.&lt;string, *>} FormData
 * @property {string} title Êï∞ÊçÆÊ†áÈ¢ò
 * @property {string} formUuid Ë°®ÂçïformUuid
 * @property {string} instanceId ÂÆû‰æãID
 * @property {string} processCode ÊµÅÁ®ãÁ†ÅÔºàüö®‰ªÖÊµÅÁ®ãÂåÖÂê´ËØ•Â≠óÊÆµÔºâ
 * @property {module:DataSource~ProcessStatus} instanceStatus 
 * ÊµÅÁ®ãÁä∂ÊÄÅÔºàüö®‰ªÖÊµÅÁ®ãÂåÖÂê´ËØ•Â≠óÊÆµÔºâÔºåÂèØËÉΩÂÄº‰∏∫ÔºöRUNNING, TERMINATED, COMPLETED, ERROR„ÄÇÂàÜÂà´‰ª£Ë°®ÔºöËøêË°å‰∏≠ÔºåÂ∑≤ÁªàÊ≠¢ÔºåÂ∑≤ÂÆåÊàêÔºåÂºÇÂ∏∏„ÄÇ
 * @property {module:DataSource~ApprovedResult} approvedResult ÂÆ°ÊâπÁªìÊûúÔºàüö®‰ªÖÊµÅÁ®ãÂåÖÂê´ËØ•Â≠óÊÆµÔºâ
 * @property {string} creator ÂàõÂª∫‰∫∫IDÔºàüö®‰ªÖË°®ÂçïÂåÖÂê´ËØ•Â≠óÊÆµÔºâ
 * @property {Object} originator ÂèëËµ∑‰∫∫ÂØπË±°
 * @property {string} originatorCorpId ÂèëËµ∑‰∫∫‰ºÅ‰∏öID
 * @property {string} originatorCorpName ÂèëËµ∑‰∫∫‰ºÅ‰∏öÂêçÁß∞
 * @property {number} gmtCreate ÂàõÂª∫Êó∂Èó¥Êà≥
 * @property {string} modifier ÊúÄÂêé‰øÆÊîπ‰∫∫IDÔºàüö®‰ªÖË°®ÂçïÂåÖÂê´ËØ•Â≠óÊÆµÔºâ
 * @property {Object} modifyUser ÊúÄÂêé‰øÆÊîπ‰∫∫ÂØπË±°Ôºàüö®‰ªÖË°®ÂçïÂåÖÂê´ËØ•Â≠óÊÆµÔºâ
 * @property {number} gmtModified ÊúÄÂêé‰øÆÊîπÊó∂Èó¥Êà≥
 */

/**
 * Êü•ËØ¢Ë°®ÂçïÂÆû‰æãÊï∞ÊçÆÂìçÂ∫îÂØπË±°
 * @typedef {Object} FormDatasResponse
 * @property {number} totalCount Ë°®ÂçïÊï∞ÊçÆÊÄªÊù°Êï∞
 * @property {number} currentPage ÂΩìÂâçÈ°µÁ†Å
 * @property {number} actualPageSize Êé•Âè£ËøîÂõûÁöÑÂΩìÂâçÈ°µÊï∞ÊçÆÈáèÔºåÂΩìÂºÄÂêØ‰∏•Ê†ºÊü•ËØ¢Êó∂Ôºå
 * Áî±‰∫éËøõË°å‰∫ÜÈ¢ùÂ§ñÁöÑÁ≠õÈÄâÔºåÊñπÊ≥ïËøîÂõûÁöÑÊï∞ÊçÆÈáèÈáèÂèØËÉΩÂ∞è‰∫éÊé•Âè£ËøîÂõûÁöÑÊï∞ÊçÆÈáè
 * @property {Array&lt;module:DataSource~FormData>} formDatas Ë°®ÂçïÂÆû‰æãÊï∞ÊçÆÊï∞ÁªÑ
 */

/**
 * ÂàÜÈ°µÊü•ËØ¢Ë°®ÂçïÂÆû‰æãÊï∞ÊçÆ &lt;br/>
 * ‚ö†Ô∏èÂ¶ÇÊûú‰ΩøÁî®ÊñáÊú¨Â≠óÊÆµÔºàÂçïË°å/Â§öË°åÊñáÊú¨Ôºâ‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂ÔºåÊâßË°åÁöÑÊòØÊ®°Á≥äÊü•ËØ¢ÔºåÊØîÂ¶ÇÊü•ËØ¢‚ÄúÂº†‰∏â‚ÄùÔºå‰ºöÊää‚ÄúÂº†‰∏â‰∏∞"‰πüÊü•ËØ¢Âá∫Êù•„ÄÇ
 * Ëã•Ë¶ÅÁ≤æÁ°ÆÊü•ËØ¢ÔºåËØ∑Â∞ÜoptionsÂèÇÊï∞ÁöÑstrictQueryÈÄâÈ°πËÆæÁΩÆ‰∏∫true
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {"form" | "process"} type Ë°®ÂçïÁ±ªÂûãÔºåÂèØÈÄâ form„ÄÅprocessÔºåÂàÜÂà´‰ª£Ë°®ÊôÆÈÄöË°®ÂçïÂíåÊµÅÁ®ã
 * @param {string} formUuid Ë°®ÂçïID
 * @param {Object} searchFieldObject Ë°®ÂçïÁªÑ‰ª∂Êü•ËØ¢Êù°‰ª∂ÂØπË±°
 * @param {number} currentPage ÂΩìÂâçÈ°µÔºå ÈªòËÆ§‰∏∫1
 * @param {number} pageSize ÊØèÈ°µËÆ∞ÂΩïÊï∞Ôºå ÈªòËÆ§‰∏∫10
 * @param {module:DataSource~SearchFormDatasOption} options Êü•ËØ¢ÈÄâÈ°π
 * @returns {Promise&lt;Array&lt;module:DataSource~FormDatasResponse>>}
 * ‰∏Ä‰∏™PromiseÔºåresolveË°®ÂçïÂÆû‰æãIDÂìçÂ∫îÂØπË±° {@link module:DataSource~FormDatasResponse}
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊôÆÈÄöË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºösearchFormDatas
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/searchFormDatas.json
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊµÅÁ®ãË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºögetInstances
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/getInstances.json
 *
 * // ÊêúÁ¥¢ÊôÆÈÄöË°®Âçï
 * searchFormDatas(
 *   this,
 *   "form",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   // Á≤æÁ°ÆÊü•ËØ¢ÔºåÊåâÁÖßnumberField_xxxÂçáÂ∫èÊéíÂ∫è
 *   { strictQuery: true, dynamicOrder: "numberField_xxx": "+" }
 * ).then((resp) => {
 *     const { currentPage, totalCount, formDatas } = resp;
 *     console.log(`ÂÖ±${totalCount}Êù°Êï∞ÊçÆ`);
 *     console.log(formDatas);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 *
 * // ÊêúÁ¥¢ÊµÅÁ®ãË°®Âçï
 * searchFormDatas(
 *   this,
 *   "process",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   // Á≤æÁ°ÆÊü•ËØ¢ÔºåÊµÅÁ®ãÁä∂ÊÄÅÂ∑≤ÂÆåÊàêÔºåÊåâÁÖßnumberField_xxxÂçáÂ∫èÊéíÂ∫è
 *   { strictQuery: true, dynamicOrder: "numberField_xxx": "+", instanceStatus: "COMPLETED" }
 * ).then((ids) => {
 *     const { currentPage, totalCount, formDatas } = resp;
 *     console.log(`ÂÖ±${totalCount}Êù°Êï∞ÊçÆ`);
 *     console.log(formDatas);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 */
async function searchFormDatas(
  context,
  type,
  formUuid,
  searchFieldObject,
  currentPage,
  pageSize,
  options
) {
  if (!context) {
    throw Error("context is required");
  }
  if (!formUuid) {
    throw Error("formUuid is required");
  }
  if (!type) {
    type = "form";
  }

  options = Object.assign({ strictQuery: false }, options);

  const searchFieldJson = JSON.stringify(searchFieldObject || {});
  if (options &amp;&amp; options.dynamicOrder) {
    options.dynamicOrder = JSON.stringify(options.dynamicOrder || {});
  }

  let req;
  if (type === "form") {
    req = context.dataSourceMap.searchFormDatas.load({
      formUuid,
      searchFieldJson,
      currentPage,
      pageSize,
      ...options,
    });
  } else if (type === "process") {
    req = context.dataSourceMap.getInstances.load({
      formUuid,
      searchFieldJson,
      currentPage,
      pageSize,
      ...options,
    });
  } else {
    throw Error("Unknow form type: ", type);
  }

  const response = await req;
  const { currentPage: cPage, totalCount, data } = response;
  let formDatas = [];
  if (type === "form") {
    formDatas = (data || []).map((item) => ({
      title: item.title,
      formUuid: item.formUuid,
      instanceId: item.formInstId,
      creator: item.creator,
      originator: item.originator,
      originatorCorpId: item.originatorCorpId,
      originatorCorpName: item.originatorCorpName,
      gmtCreate: item.gmtCreate,
      modifier: item.modifier,
      modifyUser: item.modifyUser,
      gmtModified: item.gmtModified,
      // ÊôÆÈÄöË°®ÂçïÁöÑË°®ÂçïÊï∞ÊçÆÂú®formDataÂ±ûÊÄß‰∏≠
      ...item.formData,
    }));
  } else if (type === "process") {
    formDatas = (data || []).map((item) => ({
      title: item.title,
      formUuid: item.formUuid,
      instanceId: item.processInstanceId,
      processCode: item.processCode,
      instanceStatus: item.instanceStatus,
      approvedResult: item.approvedResult,
      originator: item.originator,
      originatorCorpId: item.originatorCorpId,
      originatorCorpName: item.originatorCorpName,
      gmtCreate: item.gmtCreate,
      gmtModified: item.gmtModified,
      // ÊµÅÁ®ãË°®ÂçïÁöÑË°®ÂçïÊï∞ÊçÆÂú®dataÂ±ûÊÄß‰∏≠
      ...item.data,
    }));
  }

  const actualPageSize = formDatas.length;
  // ‰∏•Ê†ºÊü•ËØ¢ÔºåÂØπÁªìÊûúÈõÜËøõ‰∏ÄÊ≠•Á≠õÈÄâÔºåÊâÄÊúâÊñáÊú¨Á±ªÂûãÂ≠óÊÆµÂÄºÂøÖÈ°ªÂíåÊü•ËØ¢Êù°‰ª∂‰∏•Ê†ºÂåπÈÖç
  if (options.strictQuery) {
    const textFieldMap = new Map();
    for (const key in searchFieldObject) {
      const fieldType = getFieldTypeById(key);
      if (fieldType === "text" || fieldType === "textarea") {
        textFieldMap.set(key, searchFieldObject[key]);
      }
    }

    formDatas = formDatas.filter((formData) => {
      for (const [fieldId, value] of textFieldMap) {
        if (formData[fieldId] !== value) return false;
      }
      return true;
    });
  }

  return {
    currentPage: cPage,
    actualPageSize,
    totalCount,
    formDatas,
  };
}

/**
 * Êü•ËØ¢Á¨¶ÂêàÊù°‰ª∂ÁöÑÊâÄÊúâË°®ÂçïÂÆû‰æã &lt;br/>
 * ‚ö†Ô∏èÂ¶ÇÊûú‰ΩøÁî®ÊñáÊú¨Â≠óÊÆµÔºàÂçïË°å/Â§öË°åÊñáÊú¨Ôºâ‰Ωú‰∏∫Êü•ËØ¢Êù°‰ª∂ÔºåÊâßË°åÁöÑÊòØÊ®°Á≥äÊü•ËØ¢ÔºåÊØîÂ¶ÇÊü•ËØ¢‚ÄúÂº†‰∏â‚ÄùÔºå‰ºöÊää‚ÄúÂº†‰∏â‰∏∞"‰πüÊü•ËØ¢Âá∫Êù•„ÄÇ
 * Ëã•Ë¶ÅÁ≤æÁ°ÆÊü•ËØ¢ÔºåËØ∑Â∞ÜoptionsÂèÇÊï∞ÁöÑstrictQueryÈÄâÈ°πËÆæÁΩÆ‰∏∫true
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {"form" | "process"} type Ë°®ÂçïÁ±ªÂûãÔºåÂèØÈÄâ form„ÄÅprocessÔºåÂàÜÂà´‰ª£Ë°®ÊôÆÈÄöË°®ÂçïÂíåÊµÅÁ®ã
 * @param {string} formUuid Ë°®ÂçïID
 * @param {Object} searchFieldObject Ë°®ÂçïÁªÑ‰ª∂Êü•ËØ¢Êù°‰ª∂ÂØπË±°
 * @param {module:DataSource~SearchFormDatasOption} options Êü•ËØ¢ÈÄâÈ°π
 * @returns {Promise&lt;Array&lt;Object>>} ‰∏Ä‰∏™PromiseÔºåresolveË°®ÂçïÂÆû‰æãÊï∞ÊçÆÊï∞ÁªÑ
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊôÆÈÄöË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºösearchFormDatas
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/searchFormDatas.json
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊµÅÁ®ãË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºögetInstances
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöGET
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/getInstances.json
 *
 * // ÊêúÁ¥¢ÊôÆÈÄöË°®Âçï
 * searchFormDatasAll(
 *   this,
 *   "form",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   // Á≤æÁ°ÆÊü•ËØ¢ÔºåÊåâÁÖßnumberField_xxxÂçáÂ∫èÊéíÂ∫è
 *   { strictQuery: true, dynamicOrder: "numberField_xxx": "+" }
 * ).then((formDatas) => {
 *     console.log("Êü•ËØ¢ÊàêÂäü", formDatas);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 *
 * // ÊêúÁ¥¢ÊµÅÁ®ãË°®Âçï
 * searchFormDatasAll(
 *   this,
 *   "process",
 *   "FORM-xxxxxx",
 *   { textField_xxxxxx: "hello" },
 *   // Á≤æÁ°ÆÊü•ËØ¢ÔºåÊµÅÁ®ãÁä∂ÊÄÅÂ∑≤ÂÆåÊàêÔºåÊåâÁÖßnumberField_xxxÂçáÂ∫èÊéíÂ∫è
 *   { strictQuery: true, dynamicOrder: "numberField_xxx": "+", instanceStatus: "COMPLETED" }
 * ).then((formDatas) => {
 *     console.log("Êü•ËØ¢ÊàêÂäü", formDatas);
 *   },(e) => {
 *     console.log(`Êü•ËØ¢Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 */
async function searchFormDatasAll(
  context,
  type,
  formUuid,
  searchFieldObject,
  options
) {
  if (!type) type = "form";

  let allFormDatas = [];
  let currentPage = 1;
  const pageSize = 100;

  const t = true;
  while (t) {
    const { formDatas, actualPageSize } = await searchFormDatas(
      context,
      type,
      formUuid,
      searchFieldObject,
      currentPage,
      pageSize,
      options
    );
    allFormDatas = allFormDatas.concat(formDatas);

    if (actualPageSize !== pageSize) {
      break;
    }

    currentPage += 1;
  }

  return allFormDatas;
}

/**
 * Êõ¥Êñ∞Ë°®Âçï/ÊµÅÁ®ãÂÆû‰æãÊï∞ÊçÆ
 * @static
 * @param {Object} context this‰∏ä‰∏ãÊñá
 * @param {"form" | "process"} type Ë°®ÂçïÁ±ªÂûãÔºåÂèØÈÄâ form„ÄÅprocessÔºåÂàÜÂà´‰ª£Ë°®ÊôÆÈÄöË°®ÂçïÂíåÊµÅÁ®ã
 * @param {string} instanceId ÂÆû‰æãID
 * @param {Object} updateFormData Ë¶ÅÊõ¥Êñ∞ÁöÑË°®ÂçïÊï∞ÊçÆÂØπË±°
 * @param {boolean} useLatestVersion ÊòØÂê¶‰ΩøÁî®ÊúÄÊñ∞ÁöÑË°®ÂçïÁâàÊú¨ËøõË°åÊõ¥Êñ∞ÔºåÈªòËÆ§‰∏∫falseÔºå‰ªÖÂØπÊôÆÈÄöË°®ÂçïÊúâÊïà
 * @return {Promise} ‰∏Ä‰∏™PromiseÔºåÊõ¥Êñ∞ÊàêÂäüÊó∂resolveÔºåÂ§±Ë¥•Êó∂reject
 *
 * @example
 * // ‰ΩøÁî®ÂâçËØ∑Ê∑ªÂä†Êï∞ÊçÆÊ∫êÔºö
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊôÆÈÄöË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºöupdateFormData
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöPOST
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/form/updateFormData.json
 * // Â¶ÇÊûúË¶ÅÊõ¥Êñ∞ÊµÅÁ®ãË°®ÂçïÔºö
 * // ÂêçÁß∞ÔºöupdateInstance
 * // ËØ∑Ê±ÇÊñπÊ≥ïÔºöPOST
 * // ËØ∑Ê±ÇÂú∞ÂùÄÔºö/dingtalk/web/APP_xxxxxx/v1/process/updateInstance.json
 *
 * updateFormData(
 *   this,
 *   "form",
 *   "FINST-xxxxxx",
 *   { textField_xxxxxx: "a new value" },
 *   true
 * ).then(() => {
 *     console.log("Êõ¥Êñ∞ÊàêÂäü");
 *   },(e) => {
 *     console.log(`Êõ¥Êñ∞Â§±Ë¥•Ôºö${e.message}`);
 *   }
 * );
 */
async function updateFormData(
  context,
  type,
  instanceId,
  updateFormData,
  useLatestVersion = false
) {
  if (!context) throw Error("context is required");
  if (!instanceId) throw Error("instanceId is required");
  if (!type) type = "form";
  if (!updateFormData) updateFormData = {};

  const updateFormDataJson = JSON.stringify(updateFormData);

  let req;
  if (type === "form") {
    req = context.dataSourceMap.updateFormData.load({
      formInstId: instanceId,
      updateFormDataJson,
      useLatestVersion,
    });
  } else {
    req = context.dataSourceMap.updateInstance.load({
      processInstanceId: instanceId,
      updateFormDataJson,
    });
  }

  await req;
}

export {
  getFormData,
  searchFormDataIds,
  searchFormDataIdsAll,
  searchFormDatas,
  searchFormDatasAll,
  fetchSubformDatas,
  fetchSubformDatasAll,
  saveFormData,
  startInstance,
  updateFormData,
  deleteFormData,
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.2</a> on Wed Feb 28 2024 16:50:01 GMT+0800 (China Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>



</body>
</html>
